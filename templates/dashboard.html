<!DOCTYPE html>
<html lang="pt-br" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/css/dashboard.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">

    <title>Planeja Facil</title>
</head>
<body>

    <div class="overlay" id="over" style="display: none;"></div>

    <form class="adicionar-movimentacao" action="/dashboard" method="post" id="add_movi" style="display: none;">

        <div class="fechar-aba" id="fechar">
            <img class="img-fechar-aba" src="../static/img/img-x.png" alt="">
        </div>

      <h2>Adicionar operação</h2>

      <div class="div-ajustar-esquerda">
        <div class="botoes-movimentacao">

          <div class="ajustar-texto-botoes">

            <p>Escolha a Movimentação:</p>

            <select id="tipo" name="tipo" class="selecionar-movimentacao" required>
                <option value="saida">Saída</option>
                <option value="entrada">Entrada</option>
            </select>

          </div>
        </div>

        <div class="div-add-fonte">
            <label for="fonte_desc">Fonte/Descrição:</label>
            <input type="text" id="fonte_desc" name="fonte_desc" placeholder="..." class="input" required maxlength="10">
        </div>

        <div class="div-add-data">
          <label for="data">Adicione a data:</label>
          <input type="date" id="data" name="data" class="input" required>
        </div>

        <div class="div-add-valor">
          <label for="valor">Adicione o valor:</label>
          <input type="number" id="valor" name="valor" placeholder="R$ 0,00" class="input" step="0.01" required>
        </div>
      </div>


      <button class="btn-salvar" type="submit">Salvar</button>

    </form>


    <header id="Inicio" class="header">
        
        <div class="Container-Header">
            
            <div class="Textos-Header">
                <div class="logo-header">
                    <a href="/dashboard"><img class="Logo" src="../static/img/Logo_Oficial.png" alt="Logo" /></a>
                </div>

                <h1 class="Titulo-Header">Bem-Vindo <span style="color: #D1DBBD;">{{ nome }}</span>!</h1>

                <p class="Subtitulo-Header">
                    Veja como está o seu saldo atual, suas entradas e saídas!
                </p>


                <div class="div-adicionar-movimentacao">
                    <button class="btn-adcionar-movi" id="btn_add">Adicionar Movimentação</button>
                </div>

            </div>
        </div>

        <div class="logout">
           <a href="/"><img class="img-logout" src="../static/img/logout.png" alt=""></a>
        </div>

    </header>
    {% macro formatar_valor(valor) %}
    {% if valor is none %}
        {% set valor = 0 %}  {# Define valor como 0 se for None #}
    {% endif %}
    {% set valor_formatado = valor | round(2) | string %}  {# Converte o valor para string com 2 casas decimais #}
    {% if '.' in valor_formatado %}
        {% set valor_formatado = valor_formatado | replace('.', ',') %}  {# Substitui ponto por vírgula #}
    {% endif %}
    {{ valor_formatado }}
    {% endmacro %}

{% with messages = get_flashed_messages() %}
  {% if messages %}
      <h1 class="mensagem">{{ messages[0] }}</h1>
  {% endif %}
{% endwith %}

    <div class="ajuste-responsivo">
        <div class="blocos">

        <div class="blocoEntrada">
            <div class="displayflex">
                <p class="text-blocoEntrada">Entrada</p>
                <img class="img-blocos" src="../static/img/seta-entrada.png" alt="">
            </div>

            <div class="Valor-Entrada">
                <p>R$ {{ formatar_valor(total_receita) }}</p>
            </div>
        </div>

        <div class="blocoSaida">
            <div class="displayflex">
                <p class="text-blocoSaida">Saída</p>
                <img class="img-blocos" src="../static/img/seta-saida.png" alt="">
            </div>

            <div class="Valor-Saida">
                <p>R$ {{ formatar_valor(total_despesa) }}</p>
            </div>
    </div>

    <div class="blocoTotal">
        <div class="displayflex">
            <p class="text-blocoTotal">Total</p>
        </div>

        <div class="Valor-Total">
            {% set total_receita = total_receita if total_receita != None else 0 %}
            {% set total_despesa = total_despesa if total_despesa != None else 0 %}
            <p>R$ {{ formatar_valor(total_receita - total_despesa) }}</p>
        </div>
    </div>
</div>

    <div class="displayflex2">
        <div class="caixa-historico">
            {% for receita in receitas %}
            <div class="caixa-valores">

                <img class="img-seta" src="../static/img/seta-entrada.png" alt="">

                <div class="div-texto-entrada">
                    <p class="texto-caixa-Entrada" style="width: 104px; text-align: center;">{{ receita[2] }}</p>
                </div>
                {% set data_str = receita[3] | string %}
                {% set ano = data_str[0:4] %}
                {% set mes = data_str[5:7] %}
                {% set dia = data_str[8:10] %}
                {% set data = dia ~ '-' ~ mes ~ '-' ~ ano %}  {# Formato dd-mm-aaaa #}

                <div class="div-data-entrada">
                    <p class="texto-caixa-valores">{{ data }}</p>
                </div>

                <div class="div-valor-entrada">

                    <p class="texto-caixa-valores">R$ {{ formatar_valor(receita[1]) }}</p>
                </div>

                <div class="div-imgs-caixa-valores">
                    <a href="/editar_receita/{{ receita[0] }}"><img class="img-caixa-valores" src="../static/img/img-editar.png" alt=""></a>

                    <a href="/excluir_receita/{{ receita[0] }}"><img class="img-caixa-valores" src="../static/img/img-deletar.png" alt=""></a>
                </div>

            </div>
        {% endfor %}

        {% for despesa in despesas %}

            <div class="caixa-valores">


                <img class="img-seta" src="../static/img/seta-saida.png" alt="">
                
                <div class="div-texto-saida">
                    <p class="texto-caixa-Saida" style="width: 74px; text-align: center;">{{ despesa[2] }}</p>
                </div>

                {% set data_str2 = despesa[3] | string %}
                {% set ano = data_str2[0:4] %}
                {% set mes = data_str2[5:7] %}
                {% set dia = data_str2[8:10] %}
                {% set data = dia ~ '-' ~ mes ~ '-' ~ ano %}  {# Formato dd-mm-aaaa #}

                <div class="div-data-saida">
                    <p class="texto-caixa-valores">{{ data }}</p>
                </div>

                <div class="div-valor-saida">
                    {% set valor = despesa[1] %}
                    {% set valor_formatado2 = valor | round(2) | string %}  {# Converte o valor para string com 2 casas decimais #}
                    {% if '.' in valor_formatado2 %}
                        {% set valor_formatado2 = valor_formatado2 | replace('.', ',') %}  {# Substitui ponto por vírgula #}
                    {% endif %}
                    <p class="texto-caixa-valores">R$ {{ valor_formatado2 }}</p>
                </div>

                <div class="div-imgs-caixa-valores">
                    <a href="/editar_despesa/{{ despesa[0] }}"><img class="img-caixa-valores" src="../static/img/img-editar.png" alt=""></a>

                    <a href="/excluir_despesa/{{ despesa[0] }}"><img class="img-caixa-valores" src="../static/img/img-deletar.png" alt=""></a>
                </div>

            </div>
            {% endfor %}

        </div>
    </div>

    <footer>
        <div class="itens-footer">

            <div class="imgs-footer">

                <div class="img-container">
                    <img class="img-footer" src="../static/img/img-whatsapp.png" alt="Whatsapp">
                </div>
                <div class="img-container">
                    <img class="img-footer" src="../static/img/img-instagram.png" alt="Instagram">
                </div>
                <div class="img-container">
                    <img class="img-footer" src="../static/img/img-facebook.png" alt="Facebook">
                </div>
                <div class="img-container">
                    <img class="img-footer" src="../static/img/img-twitter.png" alt="Twitter">
                </div>
            </div>


            <div class="info-footer">

                <a href="http://127.0.0.1:5501/templates/index.html#NossaMissao"><p class="texto-footer">NOSSA MISSÃO</p></a>

                <a href="http://127.0.0.1:5501/templates/index.html#NossosServi%C3%A7os"><p class="texto-footer">NOSSOS SERVIÇOS</p></a>

                <a href="http://127.0.0.1:5501/templates/index.html#FaleConosco"><p class="texto-footer">FALE CONOSCO</p></a>

            </div>
        </div>

        <div class="footerpart2">
            <p class="texto-footer2">© 2024 | Planeja Fácil | Todos os direitos reservados</p>
        </div>

    </footer>


    <script>
        const btn_add = document.getElementById("btn_add")
        const fechar_aba = document.getElementById("fechar")
        function rolarParaTabela() {
            setTimeout(function() {
                if (sessionStorage.getItem('visited')) {
                    let scrollY = window.scrollY
                    window.scrollTo(0, 600)
                } else {
                    sessionStorage.setItem('visited', 'true');
                }
            }, 500)
        }

        window.addEventListener('load', rolarParaTabela);
        function fechar() {
            const over = document.getElementById("over")
            const add_movi = document.getElementById("add_movi")

            over.style.display = "none"
            add_movi.style.display = "none"
        }

        function adicionar() {
            const over = document.getElementById("over")
            const add_movi = document.getElementById("add_movi")

            over.style.display = "block"
            add_movi.style.display = "block"

        }

        btn_add.addEventListener('click', adicionar)
        fechar_aba.addEventListener('click', fechar)


        

            const btn_entrada = document.getElementById("entradaBtn")
            const btn_saida = document.getElementById("saidaBtn")
            const input = document.getElementById("tipo")
    
            function entrada() {
                input.value = "entrada"
                
                btn_entrada.style.background = "green"
                btn_entrada.style.color = "white"
                btn_entrada.style.border = "none"

                btn_saida.style.background = "#193441"
                btn_saida.style.border = "1.5px solid white"
                btn_saida.style.color = "#FF0000"

            }
    
            function saida() {
                input.value = "saida"

                btn_saida.style.background = "red"
                btn_saida.style.color = "white"
                btn_saida.style.border = "none"

                btn_entrada.style.background = "#193441"
                btn_entrada.style.color = "#28B326"
                btn_entrada.style.border = "1.5px solid white"

            }
    
            btn_entrada.addEventListener("click", entrada)
            btn_saida.addEventListener("click", saida)
            
        
    </script>

</body>
</html>